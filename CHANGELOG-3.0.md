# CHANGELOG - ZIKULA 3.0.x

## 3.0.0 (unreleased)

- BC Breaks:
  - Minimum PHP version is now 7.2.5 instead of 5.5.9 (#3935). PHP 7.2.5+ is also required by Symfony 5.
  - The directory structure is dramatically different (reflecting changes from Symfony).
    - The `public/` directory is now the *web root*. Set your server/htaccess/etc accordingly.
    - `public/index.php` is the entry point to the site.
    - See https://symfony.com/doc/current/setup/web_server_configuration.html for more information.
  - Service definitions have been updated to use Symfony autowiring and autoconfiguring functionality (#3940, #3872). This includes autowiring entity repositories by inheriting from `Doctrine\Bundle\DoctrineBundle\Repository\ServiceEntityRepository`.
  - Namespace changes
    - `Zikula\Bridge\HttpFoundation\` moved to `Zikula\Bundle\CoreBundle\HttpFoundation\Session\`.
    - `Zikula\Bundle\CoreBundle\Bundle\AbstractCoreModule` moved into `Zikula\ExtensionsModule\`.
    - `Zikula\Bundle\CoreBundle\Bundle\AbstractCoreTheme` moved into `Zikula\ThemeModule\`.
    - `Zikula\Bundle\CoreBundle\Bundle\Bootstrap` moved and renamed to `Bundle\CoreBundle\Helper\PersistedBundleHelper`.
    - `Zikula\Bundle\CoreBundle\Bundle\Helper\BootstrapHelper` moved and renamed to `Bundle\CoreBundle\Helper\BundlesSchemaHelper`.
    - `Zikula\Bundle\CoreBundle\Bundle\MetaData` moved into `Zikula\Bundle\CoreBundle\Composer\`.
    - `Zikula\Bundle\CoreBundle\Bundle\Scanner` moved into `Zikula\Bundle\CoreBundle\Composer\`.
    - `Zikula\Common\Collection\` moved into `Zikula\Bundle\CoreBundle\Collection\`.
    - `Zikula\Common\Content\` moved into `Zikula\ExtensionsModule\ModuleInterface\Content\`.
    - `Zikula\Common\MultiHook\` moved into `Zikula\ExtensionsModule\ModuleInterface\MultiHook\`.
    - `Zikula\Common\Translator\` moved into `Zikula\Bundle\CoreBundle\Translation\`.
    - `Zikula\Common\ColumnExistsTrait` moved into `Zikula\Bundle\CoreBundle\Doctrine\`.
    - `Zikula\Core\Controller\` moved into `Zikula\Bundle\CoreBundle\Controller\`.
    - `Zikula\Core\Doctrine\` moved into `Zikula\Bundle\CoreBundle\Doctrine\`.
    - `Zikula\Core\Event\GenericEvent` moved into `Zikula\Bundle\CoreBundle\Event\`.
    - `Zikula\Core\Event\ModuleStateEvent` moved into `Zikula\ExtensionsModule\Event\`.
    - `Zikula\Core\Response\` moved into `Zikula\Bundle\CoreBundle\Response\`.
    - `Zikula\Core\AbstractExtensionInstaller` moved into `Zikula\ExtensionsModule\Installer\`.
    - `Zikula\Core\AbstractModule` moved into `Zikula\ExtensionsModule\`.
    - `Zikula\Core\CoreEvents` was split into `Zikula\Bundle\CoreBundle\CoreEvents` and `Zikula\ExtensionsModule\ExtensionEvents`.
    - `Zikula\Core\ExtensionInstallerInterface` moved into `Zikula\ExtensionsModule\Installer\`.
    - `Zikula\Core\InstallerInterface` moved into `Zikula\ExtensionsModule\Installer\`.
    - `Zikula\Core\RouteUrl` moved into `Zikula\Bundle\CoreBundle\`.
    - `Zikula\Core\UrlInterface` moved into `Zikula\Bundle\CoreBundle\`.
  - Interface extensions and amendments
    - Removed second argument (`$first = true`) from `ZikulaHttpKernelInterface` methods `getModule`, `getTheme` and `isBundle` (#3377).
    - `ZikulaHttpKernelInterface` has dropped `getConnectionConfig()` method. Use environment variable `DATABASE_URL` instead.
    - In general, interfaces and apis implement argument type-hinting in all methods. This can break an implementation of said interfaces, etc.
    - `Zikula\BlocksModule\Api\ApiInterface\BlockApiInterface` has dropped `getModuleBlockPath()` method.
    - `Zikula\BlocksModule\Api\ApiInterface\BlockFactoryApiInterface` has changed signature of `getInstance()` method.
    - `Zikula\BlocksModule\BlockHandlerInterface` requires a new method `getPropertyDefaults()` to be implemented.
    - `Zikula\Bundle\HookBundle\HookProviderInterface` requires a new method `getAreaName()` to be implemented.
    - `Zikula\Bundle\HookBundle\HookSubscriberInterface` requires a new method `getAreaName()` to be implemented.
    - `Zikula\Bundle\HookBundle\HookProviderInterface` has dropped `setServiceId` and `getServiceId` methods.
    - `Zikula\Bundle\HookBundle\Collector\HookCollectorInterface` has changed signature of `addProvider()` and `addSubscriber()` methods.
    - `Zikula\Common\Content\ContentTypeInterface` requires a new method `getBundleName()` to be implemented.
    - `Zikula\PermissionsModule\Entity\RepositoryInterface\PermissionRepositoryInterface` requires a new method `deleteGroupPermissions` to be implemented.
    - `Zikula\ŞearchModule\SearchableInterface` requires a new method `getBundleName()` to be implemented.
    - `Zikula\ŞearchModule\SearchableInterface` has changed signature of `getResults()` method.        
    - `Zikula\UsersModule\MessageModule\MessageModuleInterface` requires a new method `getBundleName()` to be implemented.
    - `Zikula\UsersModule\ProfileModule\ProfileModuleInterface` requires a new method `getBundleName()` to be implemented.
  - `Zikula\BlocksModule\AbstractBlockHandler` is not container aware anymore.
  - Entity changes
    - `Zikula\ExtensionsModule\Entity\ExtensionEntity` has renamed `core_min` to `coreCompatibility` and removed `core_max` property (#3649).
    - `Zikula\PermissionsModule\Entity\PermissionEntity` removed the `bond` property.
    - `Zikula\ThemeModule\Entity\ThemeEntity` removed the `xhtml` property.
    - `Zikula\SearchModule\Entity\SearchResultEntity` has changed the `extra` field from `text` to `array`. The `setExtra()` method takes care of that though.
  - Removed `Zikula\Core\Response\Ajax\*Response` classes (#3772). Use Symfony's `JsonResponse` with appropriate status codes instead.
  - Removed all classes from the `Zikula\Core\Token` namespace. If you need custom CSRF tokens use [isCsrfTokenValid()](https://symfony.com/doc/current/security/csrf.html#generating-and-checking-csrf-tokens-manually) instead (#3206).
  - The `Zikula\Bundle\HookBundle\ServiceIdTrait` trait has been removed.
  - Dropped vendors:
    - Removed afarkas/html5shiv
    - Removed afarkas/webshim (#3925)
    - Removed bootstrap-plus/bootstrap-jqueryui (use jQuery UI directly)
    - Removed doctrine/doctrine-cache-bundle (in favour of [Symfony/Cache](https://symfony.com/doc/current/components/cache.html))
    - Removed elao/web-profiler-extra-bundle
    - Removed jms/translation-bundle (in favour of php-translation/*)
    - Removed oyejorge/less.php
    - Removed ramsey/array_column
    - Removed sensio/distribution-bundle (in favour of Flex)
    - Removed sensio/generator-bundle (in favour of symfony/maker-bundle)
    - Removed symfony/polyfill-apcu
    - Removed symfony/polyfill-php56
    - Removed symfony/polyfill-php70
    - Removed symfony/polyfill-util
    - Removed twig/extensions (use new Twig Extra extensions instead)
    - Removed zikula/andreas08-theme (in favour of different styles in bootstrap theme)
    - Removed zikula/bootstrap-bundle (in favour of direct usage of components/bootstrap)
    - Removed zikula/fontawesome-bundle (in favour of direct usage of components/font-awesome)
    - Removed zikula/generator-bundle (in favour of symfony/maker-bundle)
    - Removed zikula/jquery-bundle (in favour of direct usage of components/jquery)
    - Removed zikula/jquery-ui-bundle (in favour of direct usage of components/jqueryui)
    - Removed zikula/seabreeze-theme (in favour of different styles in bootstrap theme)
    - Replaced by stof/doctrine-extensions-bundle by antishov/doctrine-extensions-bundle
    - Downgraded kriswallsmith/assetic from 1.4.0 to 1.0.5
  - Removed `Zikula\Core\Exception\FatalErrorException` in favour of direct usage of `Symfony\Component\ErrorHandler\Error\FatalError`
  - Removed the `polyfill` Twig tag (#3925).
  - Removed the `languageName` Twig filter (use `language_name` instead ([docs](https://twig.symfony.com/doc/3.x/filters/language_name.html)))
  - Removed `ZikulaKernel::VERSION_SUB` constant.
  - On upgrade, the startController setting is removed and requires resetting with new format FQCN::method
  - `Bundle\CoreBundle\Helper\PersistedBundleHelper::getConnection` visibility set to private
  - `Bundle\CoreBundle\Helper\PersistedBundleHelper::addAutoloaders` visibility set to private
  - `Bundle\CoreBundle\Helper\BundlesSchemaHelper::createSchema` visibility set to private
  - There is no `web/bootstrap-font-awesome.css` file generated anymore. Instead, Bootstrap and Font Awesome are always included independently.
  - Removed custom translation system (#4042). Use Symfony's translation system directly.
    - Default translation domain is now always `messages`. Use specific other domains (e.g. `mail`, `config`, `hooks` etc.) where appropriate.
  - Removed use of `admin.png` and replaced by adding icon class to `composer.json` >> `extra/zikula/capabilities/admin/icon: "fas fa-user"`
  - Replaced `LinkContainer` with `ExtensionMenu` for collecting module menus (admin, user, account). See companion docs.
  - Setting `composer.json` >> `extra/zikula/capabilities/admin/url` is no longer supported. Use `extra/zikula/capabilities/admin/route`.
  - Changes regarding directory layout
    - The `src/app/config/` directory has been moved to `config/`.
    - The `src/app/Resources/<BundleName>/views/` directory is now located at `templates/bundles/<BundleName>/`.
    - The `src/app/Resources/translations/` directory became `translations/`.
    - The `src/app/Resources/views/` directory became `templates/`.
    - The `src/app/Resources/workflows/` directory became `config/workflows/`.
    - The `src/lib/Zikula/Bundle/` directory has been moved to `src/Zikula/`.
    - The `src/web/` directory has been moved to `public/`.
  - Changes regarding configuration files
    - Configuration for specific packages has been moved into `config/packages/*.yaml`.
    - The `parameters.yml` file has been renamed to `services.yaml`.
    - The `custom_parameters.yaml` file has been renamed to `services_custom.yaml`.
    - YAML files use the `.yaml` extension instead of `.yml`.
    - The `%temp_dir%` parameter has been removed. If you need a temporary folder use `sys_get_temp_dir()`.
    - The parameters `system.chmod_dir` and `url_secret` have been removed without any replacement.
    - Some other parameter have been removed in favour of environment variables
      - `env` became `APP_ENV`.
      - `debug` became `APP_DEBUG`.
      - `secret` became `APP_SECRET`.
      - `database_*` became `DATABASE_URL`.

- Fixes:
  - Check if verification record is already deleted when confirming a changed mail address.
  - Updated listener priorities in Settings module to fix non-working variable localisation (#3934).
  - Fixed broken functionality of hiding submit button in search block.
  - Provide more kernel information in coredata (#3651).
  - Cosmetical corrections for account link graphics.
  - Properly consider "user must verify" flag during user creation in ZAuth module (#3964).
  - Removed workaround for older DBAL versions (#2185).
  - Properly handle deleted user groups in permissions module (#3963).
  - Made Blocks module's JavaScript functionality more robust (#3911).
  - Removed ancient workaround in printer theme (#3653).
  - Readded missing functionality for configurable page title schemes (#3921).
  - Readded missing permission checks for specific admin area categories.
  - Fixed behaviour of recent searches list.
  - Fixed admin notification email for new registrations which was not done in some cases.
  - Improved asset merger with regards to negative weights (#3978).
  - Fixed broken JavaScript in ZAuth user modification form (#3992).
  - Fixed "remember me" problem caused by faulty session regeneration with custom lifetime in PHP 7.2+ (#3898, #4078).
  - When updating a block, orphan properties are removed (#3892).

- Features:
  - Utilise autowiring and autoconfiguring functionality from Symfony (#3940).
  - Migrated all templates to Bootstrap 4 and Font Awesome 5 (#3530, #4037).
  - Added all styles from Bootswatch to the Bootstrap theme (#4037).
  - Added option to allow users individually switching between available Bootswatch styles (#4037).
  - Centralised dynamic form field handling from Profile module in FormExtensionsBundle (#3945).
  - Allow zasset syntax for relative assets also for normal bundles.
  - Added Twig function for creating a `RouteUrl` instance (#3802).
  - Added support for separators in dropdown menus of extensions interface / module links (#3904).
  - Added common header/footer templates for login templates (#3937).
  - Added common header/footer templates for user registration and login related email templates (#3937).
  - Reworked `Zikula\Bridge\HttpFoundation\DoctrineSessionHandler` to extend `Symfony\Component\HttpFoundation\Session\Storage\Handler\AbstractSessionHandler` (#3870).
  - Support arrays and longer strings in the `extra` field of search results (#3619, #3900).
  - More user-friendly response messages during account information recovery (#3723).
  - Scalar type hints have been added to all method arguments and return values; corresponding docblocks have been dropped (#3960).
  - Added CLI Commands to manage extension installation, upgrade and uninstall (#3517).
  - Added ability to choose a Font Awesome icon for admin categories and categories (#3598).
  - Added support for creating and changing translations on-site using "Edit in Place" and/or a WebUI (#4012, #2425).
  - `LocaleApi` is now able to work with regions, too (#4012, #2425).
  - New and removed locales are automatically reflected in the configuration (#4012, #2425).
  - Added possibility to specify custom database port in installer.
  - Blocks can now specify default property defaults used for custom form fields (#3676).

- Vendor updates:
  - antishov/doctrine-extensions-bundle updated from 1.2.2 to 1.4.2
  - behat/transliterator updated from 1.2.0 to 1.3.0
  - components/bootstrap updated from 3.4.1 to 4.4.1
  - components/font-awesome updated from 4.7.0 to 5.12.0
  - composer/ca-bundle updated from 1.2.4 to 1.2.6
  - composer/composer installed in 1.9.1 (temporarily using dev-master b9d0015)
  - composer/semver updated from 1.5.0 to 1.5.1
  - composer/spdx-licenses installed in 1.5.2
  - composer/xdebug-handler installed in 1.4.0
  - doctrine/annotations updated from 1.2.7 to 1.8.0
  - doctrine/collections updated from 1.3.0 to 1.6.4
  - doctrine/common updated from 2.6.2 to 2.12.0
  - doctrine/dbal updated from 2.5.13 to 2.10.1
  - doctrine/doctrine-bundle updated from 1.6.13 to 2.0.7
  - doctrine/event-manager installed in 1.1.0
  - doctrine/inflector updated from 1.1.0 to 1.3.1
  - doctrine/instantiator updated from 1.0.5 to 1.3.0
  - doctrine/lexer updated from 1.0.2 to 1.2.0
  - doctrine/orm updated from 2.5.14 to 2.7.0
  - doctrine/persistence installed in 1.3.6
  - doctrine/reflection installed in 1.1.0
  - egulias/email-validator installed in 2.1.15
  - erusev/parsedown installed in 1.7.4
  - friendsofsymfony/jsrouting-bundle updated from 1.6.3 to 2.5.3
  - gedmo/doctrine-extensions updated from 2.4.37 to 2.4.39
  - guzzlehttp/guzzle updated from 6.4.1 to 6.5.2
  - imagine/imagine updated from 0.7.1 to 1.3.3
  - itsjavi/fontawesome-iconpicker installed in 3.2.0
  - jms/i18n-routing-bundle updated from 2.0.0 to 3.0.3 (temporarily using remmel/i18n-routing-bundle dev-master instead)
  - jquery.mmenu updated from 7.3.3 to mmenu.js 8.4.5
  - justinrainbow/json-schema updated from 4.1.0 to 5.2.9
  - knplabs/knp-menu updated from 2.2.0 to 3.1.0
  - knplabs/knp-menu-bundle updated from 2.1.3 to 3.0.0
  - league/commonmark installed in 1.2.2
  - league/html-to-markdown installed in 4.9.1
  - liip/imagine-bundle updated from 1.9.1 to 2.3.0
  - lorenzo/pinky installed in 1.0.5
  - matthiasnoback/symfony-console-form updated from 2.3.0 to 3.6.0 (temporarily using Jeroeny/dev-symfony-5 instead)
  - michelf/php-markdown updated from 1.7.0 to 1.9.0
  - monolog/monolog updated from 1.25.2 to 2.0.2
  - nikic/php-parser updated from 1.4.1 to 4.3.0
  - nyholm/nsa installed in 1.1.0
  - oro/twig-inspector installed in 1.0.2
  - paragonie/random_compat updated from 2.0.18 to 9.99.99
  - php-translation/common installed in 3.0.1
  - php-translation/extractor installed in 2.0.1
  - php-translation/symfony-bundle installed in 0.11.3
  - php-translation/symfony-storage installed in 2.1.0 (temporarily using dev-master)
  - psr/event-dispatcher installed in 1.0.0
  - ralouphie/getallheaders updated from 2.0.5 to 3.0.3
  - seld/jsonlint installed in 1.7.2
  - seld/phar-utils installed in 1.0.2
  - sensio/framework-extra-bundle updated from 3.0.29 to 5.5.3
  - sensiolabs/security-checker updated from 5.0.3 to 6.0.3
  - swiftmailer/swiftmailer updated from 5.4.12 to 6.2.3
  - symfony/contracts installed in 2.0.1
  - symfony/maker-bundle installed in 1.14.3
  - symfony/monolog-bundle updated from 3.2.0 to 3.5.0
  - symfony/phpunit-bridge updated from 3.4.14 to 5.0.4
  - symfony/polyfill-ctype updated from v1.12.0 to v1.13.1
  - symfony/polyfill-iconv installed in 1.13.1
  - symfony/polyfill-intl-grapheme installed in 1.13.1
  - symfony/polyfill-intl-icu updated from 1.11.0 to 1.13.1
  - symfony/polyfill-intl-idn updated from 1.11.0 to 1.13.1
  - symfony/polyfill-intl-messageformatter installed in 1.13.1
  - symfony/polyfill-intl-normalizer installed in 1.13.1
  - symfony/polyfill-mbstring updated from v1.12.0 to v1.13.1
  - symfony/polyfill-php72 installed in 1.13.1
  - symfony/polyfill-php73 installed in 1.13.1
  - symfony/profiler-pack installed in 1.0.4
  - symfony/swiftmailer-bundle updated from 2.4.3 to 3.4.0
  - symfony/symfony updated from 3.4.35 to 5.0.4
  - thomaspark/bootswatch installed in 4.4.1
  - tijsverkoyen/css-to-inline-styles installed in 2.2.2
  - twig/extra-bundle installed in 3.0.1
  - twig/cssinliner-extra installed in 3.0.1
  - twig/html-extra installed in 3.0.1
  - twig/inky-extra installed in 3.0.1
  - twig/intl-extra installed in 3.0.1
  - twig/markdown-extra installed in 3.0.1
  - twig/string-extra installed in 3.0.1
  - twig/twig updated from 1.42.4 to 3.0.1
  - webmozart/assert updated from 1.5.0 to 1.6.0
  - willdurand/js-translation-bundle updated from 2.6.6 to 3.0.0
  - zikula/legal-module updated from 3.1.2 to dev-master
  - zikula/oauth-module updated from 1.0.4 to dev-master
  - zikula/pagelock-module updated from 1.2.3 to dev-master
  - zikula/profile-module updated from 3.0.6 to dev-master
  - zikula/wizard updated from 2.0 to 3.0.3
