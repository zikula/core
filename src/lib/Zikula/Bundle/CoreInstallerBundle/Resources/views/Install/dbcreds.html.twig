{% extends '@ZikulaCoreInstaller/theme.html.twig' %}
{% form_theme form 'bootstrap_4_horizontal_layout.html.twig' %}

{% block title 'Zikula Core Installer :: Enter database information' %}

{% block content %}
<div>
    <fieldset>
    <legend>{{  __('Database information') }}</legend>

        {{ form_start(form) }}
        {{ form_errors(form) }}

        <div class="form-group row">
            {{ form_label(form.database_driver) }}
            <div class="col-md-9">
                {{ form_errors(form.database_driver) }}
                {{ form_widget(form.database_driver) }}
            </div>
        </div>
        <div class="form-group row">
            {{ form_label(form.dbtabletype) }}
            <div class="col-md-9">
                {{ form_errors(form.dbtabletype) }}
                {{ form_widget(form.dbtabletype) }}
            </div>
        </div>
        <div class="form-group row">
            {{ form_label(form.database_host) }}
            <div class="col-sm-9">
                {{ form_errors(form.database_host) }}
                {{ form_widget(form.database_host) }}
            </div>
        </div>
        <div class="form-group row">
            {{ form_label(form.database_user) }}
            <div class="col-md-9">
                {{ form_errors(form.database_user) }}
                {{ form_widget(form.database_user) }}
            </div>
        </div>
        <div class="form-group row">
            {{ form_label(form.database_password) }}
            <div class="col-md-9">
                {{ form_errors(form.database_password) }}
                {{ form_widget(form.database_password) }}
            </div>
        </div>
        <div class="form-group row">
            {{ form_label(form.database_name) }}
            <div class="col-md-9">
                {{ form_errors(form.database_name) }}
                {{ form_widget(form.database_name) }}
                <small class="form-text text-danger">{{ __('Ensure the database is in UTF-8 format.') }}</small>
            </div>
        </div>
        <div class="form-group row">
            <div class="col-md-9 offset-md-3">
                <p id="db-check" class="d-none"><i class="fa fa-cog fa-spin fa-fw text-success"></i>{{ __('Checking database connection...') }}</p>
                <input type="submit" id="submit_button" value="{{ __('Next') }}" class="btn btn-success" />
            </div>
        </div>

        {{ form_end(form) }}
    </fieldset>
</div>
<script>
    $(document).ready(function() {
        $('form:first *:input:text:first').focus();

        var value = $('#dbcreds_database_driver').val();

        if ('mysql' === value) {
            $('#dbcreds_dbtabletype').parent().parent().show();
        } else {
            $('#dbcreds_dbtabletype').parent().parent().hide();
        }

        $('#dbcreds_database_driver').on('change', function() {
            var value = $(this).val();

            if ('mysql' === value) {
                $('#dbcreds_dbtabletype').parent().parent().slideDown('slow');
            } else {
                $('#dbcreds_dbtabletype').parent().parent().slideUp('slow');
            }
        });

        $('#submit_button').on('click', function() {
            $('#db-check').removeClass('d-none');
        });
    });
</script>
{% endblock %}
