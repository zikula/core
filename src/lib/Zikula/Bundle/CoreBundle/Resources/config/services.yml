services:
    _defaults:
        autowire: true
        autoconfigure: true
        public: false
        bind:
            $installed: '%installed%'

    # alias interface to doctrine service
    Doctrine\Persistence\ManagerRegistry: '@doctrine'

    Zikula\Bundle\CoreBundle\:
        resource: '../../*'
        exclude: '../../{bootstrap.php,Tests,vendor}'

    Zikula\Bundle\CoreBundle\Controller\:
        resource: '../../Controller/*Controller.php'

    Zikula\Common\:
        resource: '../../../../Common/*'

    Zikula\Component\:
        resource: '../../../../Component/*'

    Zikula\Composer\:
        resource: '../../../../Composer/*'

    Zikula\Core\:
        resource: '../../../../Core/*'
        exclude: '../../../../Core/Tests'

    Zikula\Bundle\CoreBundle\HttpKernel\ZikulaHttpKernelInterface: '@kernel'

    Zikula\Bundle\CoreBundle\Controller\MainController:
        public: true

    Zikula\Bundle\CoreBundle\DataCollector\ZikulaVersionDataCollector:
        tags:
            - { name: data_collector, template: '@Core/Collector/ZikulaVersion.html.twig', id: 'zikula_version', priority: 300 }

    # public because used in \Zikula\SecurityCenterModule\SecurityCenterModuleInstaller::upgrade
    # and \Zikula\MailerModule\MailerModuleInstaller::upgrade from the container
    Zikula\Bundle\CoreBundle\DynamicConfigDumper:
        public: true
        arguments:
          $configDir: '%kernel.project_dir%/app/config'

    # public because Zikula\Bundle\CoreInstallerBundle\Command\Install\StartCommand accesses this using container
    Zikula\Bundle\CoreBundle\CacheClearer:
        public: true
        arguments:
          $cacheDir: '%kernel.cache_dir%'
          $kernelContainerClass: '%kernel.container_class%'
          $fosJsRoutesExtractor: '@fos_js_routing.extractor'
          $routingLocales: '%jms_i18n_routing.locales%'

    Zikula\Core\LinkContainer\LinkContainerCollector:
        arguments:
          $linkContainers: !tagged_iterator zikula.link_container

    Zikula\Bundle\CoreBundle\EventListener\BlameListener:
        arguments:
          $blameableListener: '@stof_doctrine_extensions.listener.blameable'

    Zikula\Bundle\CoreBundle\EventListener\ClickjackProtectionListener:
        arguments:
          $xFrameOptions: '%security.x_frame_options%'

    Zikula\Bundle\CoreBundle\EventListener\DoctrineListener:
        arguments:
          $driver: '@doctrine.orm.default_annotation_metadata_driver'

    Zikula\Bundle\CoreBundle\EventListener\SiteOffVetoLoginListener:
        lazy: true

    Zikula\Bundle\CoreBundle\EventListener\ExceptionListener:
        tags:
            - { name: monolog.logger, channel: request }

    Zikula\Bundle\CoreBundle\EventListener\LoggerListener:
        arguments:
          $loggableListener: '@stof_doctrine_extensions.listener.loggable'

    Symfony\Component\HttpKernel\Fragment\FragmentHandler: '@fragment.handler'

    Michelf\:
        resource: '../../../../../../vendor/michelf/php-markdown/Michelf/*'

    # public because AbstractExtensionInstaller accesses this using container
    Zikula\Core\Doctrine\Helper\SchemaHelper:
        public: true
        lazy: true

    Zikula\Common\Translator\TranslatorInterface: '@Zikula\Common\Translator\Translator'

    # public because AbstractBundle, AbstractController and AbstractExtensionInstaller access this using container
    Zikula\Common\Translator\Translator:
        public: true
        arguments:
          $defaultLocale: '%kernel.default_locale%'
          $loaderIds: {}
          $options: { cache_dir: "%kernel.cache_dir%/translations", debug: '%kernel.debug%' }

    Zikula\Bundle\CoreBundle\Translation\ZikulaPhpFileExtractor:
        arguments:
            $docParser: '@jms_translation.doc_parser'
        tags: ['jms_translation.file_visitor']

    Zikula\Bundle\CoreBundle\Translation\ZikulaTwigFileExtractor:
        tags: ['jms_translation.file_visitor']

    Zikula\Bundle\CoreBundle\Translation\ZikulaJsFileExtractor:
        tags: ['jms_translation.file_visitor']

    Zikula\Bundle\CoreBundle\Translation\Dumper\PotDumper:
        tags:
            - { name: jms_translation.dumper, format: pot }

    Zikula\Bundle\CoreBundle\Translation\SymfonyLoader\MockPotFileLoader:
        tags:
            - { name: translation.loader, alias: pot }
