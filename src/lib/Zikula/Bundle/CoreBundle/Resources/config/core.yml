parameters:
    zikula_core.internal.doctrine_connector.class: Zikula\Bundle\CoreBundle\EventListener\DoctrineListener

    zikula_core.internal.token.storage.class: Zikula\Core\Token\Storage\SessionStorage
    zikula_core.internal.token.generator.class: Zikula\Core\Token\Generator
    zikula_core.internal.token.validator.class: Zikula\Core\Token\Validator
    zikula_core.common.csrf_token_handler.class: Zikula\Core\Token\CsrfTokenHandler
    zikula_core.internal.token.max_life: 3600

    zikula_core.common.markdown.class: Michelf\Markdown
    zikula_core.common.markdown_extra.class: Michelf\MarkdownExtra

    zikula_core.internal.clickjack_protection_listener.class: Zikula\Bundle\CoreBundle\EventListener\ClickjackProtectionListener
    zikula_core.internal.site_off_listener.class: Zikula\Bundle\CoreBundle\EventListener\SiteOffListener
    zikula_core.internal.session_expire_listener.class: Zikula\Bundle\CoreBundle\EventListener\SessionExpireListener
    zikula_core.internal.exception_listener.class: Zikula\Bundle\CoreBundle\EventListener\ExceptionListener
    zikula_core.internal.output_compression_listener.class: Zikula\Bundle\CoreBundle\EventListener\OutputCompressionListener
    zikula_core.internal.strip_front_controller_listener.class: Zikula\Bundle\CoreBundle\EventListener\StripFrontControllerListener
    zikula_core.common.doctrine.schema_tool.class: Zikula\Core\Doctrine\Helper\SchemaHelper
    zikula_core.internal.bootstrap_helper.class: Zikula\Bundle\CoreBundle\Bundle\Helper\BootstrapHelper

services:
    zikula_core.common.markdown_parser:
        class: %zikula_core.common.markdown.class%

    zikula_core.common.markdown_extra_parser:
        class: %zikula_core.common.markdown_extra.class%

    zikula_core.internal.doctrine_init:
        class: %zikula_core.internal.doctrine_connector.class%
        arguments: ["@service_container"]
        tags:
            - { name: kernel.event_subscriber }

    zikula_core.internal.token.storage:
        class: %zikula_core.internal.token.storage.class%
        arguments: ["@session"]

    zikula_core.internal.token.generator:
        class: %zikula_core.internal.token.generator.class%
        arguments: ["@zikula_core.internal.token.storage", "_dummy", "%zikula_core.internal.token.max_life%"]

    zikula_core.internal.token.validator:
        class: %zikula_core.internal.token.validator.class%
        arguments: ["@zikula_core.internal.token.generator"]

    zikula_core.common.csrf_token_handler:
        class: %zikula_core.common.csrf_token_handler.class%
        arguments: ["@zikula_core.internal.token.generator", "@zikula_core.internal.token.validator", "@request_stack", "@zikula_extensions_module.api.variable", "@session"]

    zikula_core.internal.clickjack_protection_listener:
        class: %zikula_core.internal.clickjack_protection_listener.class%
        arguments: ["%security.x_frame_options%"]
        tags:
            - { name: kernel.event_subscriber }

    zikula_core.internal.site_off_listener:
        class: %zikula_core.internal.site_off_listener.class%
        arguments: ["@zikula_extensions_module.api.variable", "@zikula_permissions_module.api.permission", "@zikula_users_module.current_user", "@templating", "@form.factory", "@router", "%installed%"]
        tags:
            - { name: kernel.event_subscriber }

    zikula_core.internal.session_expire_listener:
        class: %zikula_core.internal.session_expire_listener.class%
        arguments: ["%installed%"]
        tags:
            - { name: kernel.event_subscriber }

    zikula_core.internal.exception_listener:
        class: %zikula_core.internal.exception_listener.class%
        arguments: ["@?logger", "@router", "@event_dispatcher", "@zikula.cache_clearer", "@zikula_users_module.current_user", "%installed%"]
        tags:
            - { name: kernel.event_subscriber }
            - { name: monolog.logger, channel: request }

    zikula_core.internal.output_compression_listener:
        class: %zikula_core.internal.output_compression_listener.class%
        arguments: ["@zikula_extensions_module.api.variable", "%installed%"]
        tags:
            - { name: kernel.event_subscriber }

    zikula_core.internal.strip_front_controller_listener:
        class: %zikula_core.internal.strip_front_controller_listener.class%
        arguments: ["@zikula_extensions_module.api.variable", "%installed%"]
        tags:
            - { name: kernel.event_subscriber }

    zikula_core.common.doctrine.schema_tool:
        class: %zikula_core.common.doctrine.schema_tool.class%
        lazy: true
        arguments: ["@doctrine.orm.default_entity_manager"]

    zikula_core.internal.bootstrap_helper:
        class: %zikula_core.internal.bootstrap_helper.class%
        arguments: ["@doctrine.dbal.default_connection", "@zikula.cache_clearer"]
