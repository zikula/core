{% set scriptInit %}
    <script>
        // some defines
        var adminpermission = {{ adminId }};
        var lockadmin = {{ lockadmin }};
    </script>
{% endset %}
{{ pageAddAsset('header', scriptInit) }}
{{ pageAddAsset('stylesheet', asset('jquery-ui/themes/base/jquery-ui.min.css')) }}
{{ pageAddAsset('javascript', asset('jquery-ui/jquery-ui.min.js')) }}
{{ pageAddAsset('javascript', zasset('@ZikulaPermissionsModule:js/Zikula.Permission.Admin.View.js')) }}
{{ adminHeader() }}
<h3>
    <span class="fa fa-list"></span>
    {{ __('Permission rules list') }}
    {{ pageSetVar('title', __('Permission rules list')) }}
</h3>
{% if enableFilter %}
    {% form_theme filterForm with [
        '@ZikulaCategoriesModule/Form/filter_layout_customizations.html.twig',
        '@ZikulaFormExtension/Form/form_div_layout.html.twig'
    ] %}
    {{ form_start(filterForm) }}
    <fieldset>
        <legend class="mb-0">{{ __('Filter') }}</legend>
        {{ form_widget(filterForm.filterGroup) }}
        {{ form_widget(filterForm.filterComponent) }}
        {{ form_widget(filterForm.reset) }}
    </fieldset>
    {{ form_end(filterForm) }}
{% endif %}

<div class="table-responsive">
<table id="permission-list" class="table table-sm table-bordered table-striped">
    <colgroup>
        <col id="cPosition" />
        <col id="cId" />
        <col id="cGroup" />
        <col id="cComponent" />
        <col id="cInstance" />
        <col id="cLevel" />
        <col id="cActions" />
    </colgroup>
    <thead>
        <tr>
            <th id="hPosition" scope="col" class="text-left"></th>
            <th id="hId" scope="col" class="text-left">{{ __('ID') }}</th>
            <th id="hGroup" scope="col" class="text-left">
                {{ __('Group') }}
                <span id="filter-warning-group" class="d-none text-danger"> ({{ __('filtered') }})</span>
            </th>
            <th id="hComponent" scope="col" class="text-left">
                {{ __('Component') }}
                <span id="filter-warning-component" class="d-none text-danger"> ({{ __('filtered') }})</span>
            </th>
            <th id="hInstance" scope="col" class="text-left">
                {{ __('Instance') }}
            </th>
            <th id="hLevel" scope="col" class="text-left">
                {{ __('Permission level') }}
            </th>
            <th id="hActions" scope="col" class="text-left">
                {{ __('Actions') }}
            </th>
        </tr>
    </thead>
    <tbody>
        {% for permission in permissions %}
            {{ include('@ZikulaPermissionsModule/Permission/permissionTableRow.html.twig') }}
        {% endfor %}
    </tbody>
</table>
</div>

{% form_theme permissionCheckForm with [
    'bootstrap_4_horizontal_layout.html.twig',
    '@ZikulaFormExtension/Form/form_div_layout.html.twig'
] %}
{{ form_start(permissionCheckForm) }}
{{ form_errors(permissionCheckForm) }}
<fieldset>
    <legend>{{ __('User permission check') }}</legend>
    {{ form_row(permissionCheckForm.user) }}
    {{ form_row(permissionCheckForm.component) }}
    {{ form_row(permissionCheckForm.instance) }}
    {{ form_row(permissionCheckForm.level) }}
    <div class="form-group">
        <div class="form-text col-md-9 offset-md-3 font-weight-bold" id="permission-test-info" data-testing="{{ __('Testing permission...') }}">
        </div>
    </div>
    <div class="form-group row">
        <div class="col-md-9 offset-md-3">
            {{ form_widget(permissionCheckForm.check) }}
            {{ form_widget(permissionCheckForm.reset) }}
        </div>
    </div>
</fieldset>
{{ form_end(permissionCheckForm) }}

<div class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-labelledby="editModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editModalLabel">{{ __('Permission') }}</h5>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">{{ __('Close') }}</span></button>
            </div>
            <div class="modal-body">
                {# empty #}
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal"><i class='fa fa-times'></i> {{ __('Close') }}</button>
                <button id="save-permission" type="button" class="btn btn-success" data-dismiss="modal"><i class='fa fa-check'></i> {{ __('Save') }}</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="instanceInfoModal" tabindex="-1" role="dialog" aria-labelledby="instanceInfoModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="instanceInfoModalLabel">{{ __('Permission rule information') }}</h5>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">{{ __('Close') }}</span></button>
            </div>
            <div class="modal-body">
                {{ include('@ZikulaPermissionsModule/Permission/instanceinfo.html.twig') }}
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="deleteModal" tabindex="-1" role="dialog" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-body">
                <h5 class="modal-title" id="deleteModalLabel">{{ __('Do you really want to delete this permission rule?') }}</h5>
                <button type="button" class="close" data-dismiss="modal"><span aria-hiddenq="true">&times;</span><span class="sr-only">{{ __('Close') }}</span></button>
            </div>
            <div class="modal-footer">
                <button id="confirm-delete-permission" type="button" class="btn btn-danger" data-dismiss="modal">{{ __('Yes') }}</button>
                <button type="button" class="btn btn-default" data-dismiss="modal">{{ __('No') }}</button>
            </div>
        </div>
    </div>
</div>
{{ adminFooter() }}
