{% form_theme form with [
    '@ZikulaFormExtension/Form/bootstrap_4_zikula_admin_layout.html.twig',
    '@ZikulaFormExtension/Form/form_div_layout.html.twig'
] %}
{{ adminHeader() }}
<h3>
    <span class="fas fa-plus"></span>
    {% trans with {'%uname': form.vars.value.uname} %}Edit user account of %uname{% endtrans %}
    {{ pageSetVar('title', 'Edit user account'|trans) }}
</h3>
<div class="alert alert-warning">{% trans %}The items that are marked with an asterisk (\'*\') are required entries.{% endtrans %}</div>
{% if form.vars.value.uid == currentUser.uid %}
    <div class="alert alert-danger">{% trans %}WARNING: You appear to be editing your OWN account.{% endtrans %}</div>
{% endif %}
{{ form_start(form) }}
{{ form_errors(form) }}
<fieldset>
    <legend>{% trans %}Account information{% endtrans %}</legend>
    {{ form_row(form.uname) }}
    {{ form_row(form.email) }}
</fieldset>
<fieldset>
    <legend>{% trans %}Log-in information{% endtrans %}</legend>
    {{ form_row(form.setpass, {attr: {'data-toggle': 'collapse', 'data-target': '#' ~ form.setpass.vars.id ~ '_wrap'}}) }}
    <div id="{{ form.setpass.vars.id }}_wrap" class="collapse{% if form.setpass.vars.data %} show {% endif %}">
        {{ form_row(form.pass) }}
        <div id="{{ form.vars.id }}_passmeter" class="col-md-9 offset-md-3"></div>
    </div>
</fieldset>
{% for additional_template in additional_templates %}
    {{ include(additional_template.0, additional_template.1, ignore_missing = true) }}
{% endfor %}
{{ notifyDisplayHooks(constant('Zikula\\UsersModule\\HookSubscriber\\UserManagementUiHooksSubscriber::EDIT_FORM'), form.vars.value.uid) }}
<div class="form-group row">
    <div class="col-md-9 offset-md-3">
        {{ form_widget(form.submit) }}
        {{ form_widget(form.cancel) }}
    </div>
</div>
{{ form_end(form) }}
{{ adminFooter() }}
{% set customScript %}
<script>
    (function($) {
        $(document).ready(function() {
            var setPassEle = $('#{{ form.setpass.vars.id }}');
            var setPassAlert = setPassEle.parent().find('.alert');
            var setPassWrap = $('#{{ form.setpass.vars.id }}_wrap');
            var passFirst = $('#{{ form.pass.vars.id }}_first');
            var passSecond = $('#{{ form.pass.vars.id }}_second');
            var showPasswordsRequired = function() {
                passFirst.prop('required', true);
                passFirst.parents('.form-group').find('label').addClass('required');
                passSecond.prop('required', true);
                passSecond.parents('.form-group').find('label').addClass('required');
            };
            var showPasswordsOptional = function() {
                passFirst.prop('required', false);
                passFirst.parents('.form-group').find('label').removeClass('required');
                passSecond.prop('required', false);
                passSecond.parents('.form-group').find('label').removeClass('required');
            };
            setPassAlert.addClass('collapse show');
            showPasswordsOptional();

            // ensure wrap is shown on form re-draw
            if (setPassEle.is(':checked')) {
                setPassWrap.collapse('show');
                setPassAlert.collapse('hide');
                showPasswordsRequired();
            }
            // add/remove required UI for password fields
            setPassWrap.on('show.bs.collapse', function() {
                setPassAlert.collapse('hide');
                showPasswordsRequired();
            }).on('hide.bs.collapse', function() {
                setPassAlert.collapse('show');
                showPasswordsOptional();
            });
        });
    })(jQuery);
</script>
{% endset %}
{{ pageAddAsset('footer', customScript) }}
{% if getModVar('ZikulaZAuthModule', constant('Zikula\\ZAuthModule\\ZAuthConstant::MODVAR_PASSWORD_STRENGTH_METER_ENABLED')) %}
{{ pageAddAsset('javascript', zasset('@ZikulaZAuthModule:js/Zikula.ZAuth.PassMeter.js')) }}
{% set customScript %}
<script>
    (function($) {
        $(document).ready(function() {
            ZikulaZAuthPassMeter.init('{{ form.pass.vars.id }}_first', '{{ form.vars.id }}_passmeter', {
                username: '{{ form.uname.vars.id }}',
                minLength: '{{ getModVar('ZikulaZAuthModule', constant('Zikula\\ZAuthModule\\ZAuthConstant::MODVAR_PASSWORD_MINIMUM_LENGTH')) }}'
            });
        });
    })(jQuery);
</script>
{% endset %}
{{ pageAddAsset('footer', customScript) }}
{% endif %}
